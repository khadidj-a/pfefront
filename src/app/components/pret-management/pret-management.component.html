<div class="topbar">
  <div class="logo">
    <img src="assets/logo-eng.jpg" alt="ENG Logo" />
    <span class="site-name">Gestion des parcs des √©quipements</span>
  </div>


  <div class="menu-center">
    <a class="menu-button" (click)="navigateTo('/dashboard')">Dashboard</a>
    <div class="dropdown">
      <button class="menu-button">√âquipement</button>
      <div class="dropdown-content">
        <a href="/equipment">Table √âquipement</a>
        <a href="/fiche-equipement">Fiche √âquipement</a>
      </div>
    </div>
    <a class="menu-button" *ngIf="isAdminIT" (click)="navigateTo('/user-management')">Utilisateur</a>
    <div class="dropdown">
      <button class="menu-button">Mouvement</button>
      <div class="dropdown-content">
        <a href="/movements/pret">Pr√™t</a>
        <a href="/reaffectation">R√©affectation</a>
        <a href="/reforme">R√©forme</a>
        
      </div>
    </div>

    <div class="dropdown" *ngIf="isAdminIT || isAdminMetier">
      <button class="menu-button">Table de Codification</button>
      <div class="dropdown-content"> 
        <a href="/caracteristique">Caract√©ristique</a>
        <a href="/categorie">Cat√©gorie</a> 
        <a href="/groupeidentique">Groupe Identique</a>  
        <a href="/marque">Marque</a>
        <a href="/organe">Organe</a>
        <a href="/typeeq">Type d'√©quipement</a>
        <a href="/unite">Unit√©</a>
       
      </div>
    </div>
  </div>


  <div class="profile" (click)="profileOpen = !profileOpen">
    <img class="profile-img" src="assets/user.png" alt="Profil utilisateur" />
    <span class="profile-name">{{ user.nom }} {{ user.prenom }}</span>
    <div class="profile-menu" *ngIf="profileOpen">
  <div class="menu-username">{{ user.nom }} {{ user.prenom }}</div>
      <button class="logout-btn" (click)="logout()">D√©connexion</button>
    </div>
  </div>
</div>


<div class="container">
  <div class="toolbar">
    <input class="form-control" type="text" [(ngModel)]="searchTerm" placeholder="üîç Rechercher..." (input)="search()" />
    <select class="form-control" [(ngModel)]="sortBy" (change)="search()">
        <option value="equipement">D√©signation √âquipement</option>
        <option value="codeequipement">Code √âquipement</option>
        <option value="unite">Unit√© Actuel</option>
        <option value="positionphysique">Unite cibl√©e</option>
        <option value="date">Date</option>
        <option value="duree">Dur√©e</option>
        <option value="motif">Motif</option>
      
      
    </select>
   <button class="btn sort-btn" (click)="toggleSortOrder()">
      <span class="arrow">{{ order === 'asc' ? '‚ñ≤' : '‚ñº' }}</span>
    </button>
    
    <div class="spacer"></div>
    <button class="btn orange btn-ajouter" *ngIf="isAdminIT || isAdminMetier" (click)="openForm()">Pr√™ter un √©quipement</button>


  </div>
  <!-- Dans le template HTML -->


    <!-- Barre sup√©rieure -->
  
    <h2 class="header">
      Liste des Prets
      <span class="tooltip badge">
        {{ pretCount }}
        <span class="tooltip-text">Nombre total des prets</span>
      </span>
    </h2>
  
    <!-- Tableau des pr√™ts -->
    <table >
      <thead>
        <tr>
          <th>Code √âquipement</th>
          <th>D√©signation √âquipement</th>
          <th>Unit√© pr√™teuse</th>
          <th>Unit√© emprunteuse</th>
          <th>Date Pr√™t</th>
          <th>Dur√©e (jours)</th>
          <th>Motif</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let pret of prets">
          <td>{{ getCodeEqp(pret.ideqpt) }}</td>
          <td>{{ getDesignation(pret.ideqpt) }}</td>
          <td>{{ pret.iduniteemt !== null ? getUniteEmissionName(pret.iduniteemt) : '' }}</td>
          <td>{{ getUniteName(pret.idunite) }}</td>
          <td>{{ pret.datepret | date: 'yyyy-MM-dd' }}</td>
          <td>{{ pret.duree }} jours</td>
          <td class="wrap-text">{{ pret.motif }}</td>
        </tr>
      </tbody>
    </table>
    
           
    
    <!-- Formulaire ajout/modification -->
    <div class="modal" *ngIf="showForm">
      <div class="form">
        <h3>Pr√™ter un √©quipement</h3>
  
      <form > 
        <div class="form-section">
          <div class="form-group">
        <label>√âquipement :</label>
        <select [(ngModel)]="newPret.ideqpt" class="form-control long-select" name="equipement"
        (change)="onEquipementChange()" required>
          <option *ngFor="let e of equipements" [value]="e.idEqpt">{{ e.design }}</option>
        </select> </div>
      
        <div class="form-group" *ngIf="uniteActuelle">
          <label>Unit√© pr√™teuse:</label>
          <input class="form-control" type="text" [value]="uniteActuelle.designation" disabled />
        </div>
        <div class="form-group" *ngIf="positionPhysique">
          <label>Position Physique :</label>
          <input class="form-control" type="text" [value]="positionPhysique" disabled />
        </div>
        
        
        <div class="form-group">
        <label>Unit√© cibl√©e :</label>
        <select [(ngModel)]="newPret.idunite" class="form-control long-select" name="unite" required>
          <option *ngFor="let u of unites" [value]="u.idunite">{{ u.designation }}</option>
        </select></div>
        <div class="form-group">
        <label>Date du pr√™t :</label>
        <input type="date" class="form-control " [(ngModel)]="newPret.datepret" name="datepret" required />
      </div>
       <div class="form-group">
        <label>Dur√©e (jours) :</label>
        <input type="number" class="form-control " [(ngModel)]="newPret.duree" name="duree" min="1" required />
      </div>
      <div class="form-group">
        <label>Motif :</label>
        <textarea [(ngModel)]="newPret.motif" name="motif" placeholder="Motif de la pret"></textarea>
      </div>
      
      <div class="actions">
        <button type="button" class="btn orange" (click)="addPret()">Enregistrer</button>
        <button type="button" class="btn grey" (click)="closeForm()">Annuler</button>
      </div>
      </div>
    </form>
    </div></div>
</div>
<!-- Modal de d√©connexion -->
<div class="modal" *ngIf="showLogoutConfirm">
  <div class="form">
    <h3>D√©connexion</h3>
    <p>√ätes-vous s√ªr de vouloir vous d√©connecter ?</p>
    <div class="actions">
      <button class="btn orange" (click)="confirmLogout()">Oui</button>
      <button class="btn grey" (click)="cancelLogout()">Non</button>
    </div>
  </div>
</div>
